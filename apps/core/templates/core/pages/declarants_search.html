{% extends "base.html" %}
{% load static %}
{% block title %}–ü–æ—à—É–∫ –¥–µ–∫–ª–∞—Ä–∞–Ω—Ç—ñ–≤{% endblock %}
{% block content %}
<div class="search-container">
    <h2>–ü–æ—à—É–∫ –¥–µ–∫–ª–∞—Ä–∞–Ω—Ç—ñ–≤ —á–µ—Ä–µ–∑ API –ù–ê–ó–ö</h2>

    <!-- –ü–æ—à—É–∫ –∑–∞ –ü–Ü–ë -->
    <form method="post" class="search-form">
        {% csrf_token %}
        <input type="hidden" name="search_type" value="name">
        <input type="text" name="lastname" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ">
        <input type="text" name="firstname" placeholder="–Ü–º'—è">
        <input type="text" name="middlename" placeholder="–ü–æ –±–∞—Ç—å–∫–æ–≤—ñ">
        <button type="submit">üîç –ü–æ—à—É–∫ –∑–∞ –ü–Ü–ë</button>
    </form>

    <!-- –ü–æ—à—É–∫ –∑–∞ ID -->
    <form method="post" class="search-form">
        {% csrf_token %}
        <input type="hidden" name="search_type" value="id">
        <input type="text" name="user_declarant_id" placeholder="ID –¥–µ–∫–ª–∞—Ä–∞–Ω—Ç–∞">
        <button type="submit">üîç –ü–æ—à—É–∫ –∑–∞ ID</button>
    </form>

    {% if results %}
        <h3>
            –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É ‚Äì –∑–Ω–∞–π–¥–µ–Ω–æ {{ count }}
            {% if count >= 10000 %}
                <span style="color: #d9534f; font-size: 0.9em;">(–æ–±–º–µ–∂–µ–Ω–Ω—è –ê–†–Ü –ù–ê–ó–ö)</span>
            {% endif %}
        </h3>

        {% if total_pages > 1 %}
        <div class="pagination">
            {% if page > 1 %}
                <a href="?page=1{% if pagination_querystring %}&{{ pagination_querystring }}{% endif %}">‚èÆ –ü–µ—Ä—à–∞</a>
            {% endif %}

            {% if page|add:-10 > 0 %}
                <a href="?page={{ page|add:-10 }}{% if pagination_querystring %}&{{ pagination_querystring }}{% endif %}">‚è™ -10</a>
            {% endif %}

            {% if page > 1 %}
                <a href="?page={{ page|add:-1 }}{% if pagination_querystring %}&{{ pagination_querystring }}{% endif %}">‚¨Ö –ü–æ–ø–µ—Ä–µ–¥–Ω—è</a>
            {% endif %}

            <span>–°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page }} –∑ {{ total_pages }}</span>

            {% if page < total_pages %}
                <a href="?page={{ page|add:1 }}{% if pagination_querystring %}&{{ pagination_querystring }}{% endif %}">–ù–∞—Å—Ç—É–ø–Ω–∞ ‚û°</a>
            {% endif %}

            {% if page|add:10 <= total_pages %}
                <a href="?page={{ page|add:10 }}{% if pagination_querystring %}&{{ pagination_querystring }}{% endif %}">+10 ‚è©</a>
            {% endif %}

            {% if page < total_pages %}
                <a href="?page={{ total_pages }}{% if pagination_querystring %}&{{ pagination_querystring }}{% endif %}">–û—Å—Ç–∞–Ω–Ω—è ‚è≠</a>
            {% endif %}
        </div>

        {% endif %}

        <div class="search-cards-grid">
            {% for r in results %}
            <div class="search-card">
                <h4>
                    {{ r.lastname }} {{ r.firstname }} {{ r.middlename }}
                </h4>
                <p>
                    <b>ID –¥–µ–∫–ª–∞—Ä–∞–Ω—Ç–∞:</b>
                    <span class="id-text">{{ r.user_declarant_id }}</span>
                </p>

                <p>
                    <b>–î–∞—Ç–∞ —Ç–∞ —á–∞—Å –ø–æ–¥–∞–Ω–Ω—è:</b>
                    <span class="date-text">{{ r.date }}</span>
                </p>

                <p>
                    üìë <span class="doc-type">{{ r.document_type_display }}</span>
                    {% if r.declaration_type_display %}
                        (<span class="decl-type">{{ r.declaration_type_display }}</span>)
                    {% endif %}
                </p>

                {% if r.declaration_period and r.document_type_display != "–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å—É—Ç—Ç—î–≤—ñ –∑–º—ñ–Ω–∏ –≤ –º–∞–π–Ω–æ–≤–æ–º—É —Å—Ç–∞–Ω—ñ" and r.document_type_display != "–í–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–µ–∫–ª–∞—Ä–∞—Ü—ñ—è" %}
                    <p>
                        <b>–ó–≤—ñ—Ç–Ω–∏–π –ø–µ—Ä—ñ–æ–¥:</b>
                        <span class="period-text">{{ r.declaration_period }}</span>
                    </p>
                {% endif %}
                <p>
                    <b>–ü–æ—Å–∞–¥–∞:</b> <span class="work-info">{{ r.work_post }}</span>
                </p>
                <p>
                    <b>–ú—ñ—Å—Ü–µ —Ä–æ–±–æ—Ç–∏:</b> <span class="work-info">{{ r.work_place }}</span>
                </p>

                <div class="card-actions">
                    <form method="post" >
                        {% csrf_token %}
                        <button type="submit" class="action-btn">
                            <img src="{% static 'icons/plus3d.png' %}" alt="add">
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    {% elif empty_name_search %}
    <div class="search-message error">–î–ª—è –ø–æ—à—É–∫—É –¥–µ–∫–ª–∞—Ä–∞–Ω—Ç—ñ–≤ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–≤–µ—Å—Ç–∏ –¥–∞–Ω—ñ —Ö–æ—á–∞ –± —É –æ–¥–Ω–µ –∑ –ø–æ–ª—ñ–≤ –ü–Ü–ë</div>
    {% elif empty_id_search %}
        <div class="search-message error">–ü–æ–ª–µ ID –¥–µ–∫–ª–∞—Ä–∞–Ω—Ç–∞ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º</div>
    {% elif query.lastname or query.firstname or query.middlename or query.user_declarant_id %}
        {% if not results %}
            <div class="search-message warning">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!</div>
        {% endif %}
    {% endif %}
</div>
{% endblock content %}